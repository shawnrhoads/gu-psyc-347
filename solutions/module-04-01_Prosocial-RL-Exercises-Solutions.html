
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prosocial RL Exercises Solutions</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://shawnrhoads.github.io/gu-psyc-347/solutions/module-04-01_Prosocial-RL-Exercises-Solutions.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KG3N20S55G"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-KG3N20S55G');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Module 00
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-00_Syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-01_Course-Schedule.html">
   Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-02_Course-Assignments.html">
   Course Assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-03_Reading-List.html">
   Reading List
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-04_Getting-Started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-05_Final-Projects.html">
   Final Project Guidelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-00-06_Contributing.html">
   Contributing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 01
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../module-01-00_Jupyter-Notebooks.html">
   Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-01-01_Intro-to-Python.html">
   Intro to Python Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-01-02_Working-with-Data.html">
   Working with Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-01-03_Python-Exercises.html">
   Python Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 02
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../module-02-00_Linear-Modeling.html">
   Linear Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-02-01_Nonlinear-Modeling.html">
   Nonlinear Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-02-02_Modeling-Exercises.html">
   Modeling Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 03
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../module-03-00_Two-Armed-Bandit.html">
   Two-Armed Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-03-01_Models-of-Learning.html">
   Models of Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-03-02_RL-Exercises.html">
   RL Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Module 04
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../module-04-00_Social-Learning.html">
   Social Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-04-01_Prosocial-RL-Exercises.html">
   Prosocial RL Exercises
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../module-04-XX_Future-Directions.html">
   Future Directions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/solutions/module-04-01_Prosocial-RL-Exercises-Solutions.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/shawnrhoads/gu-psyc-347"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/shawnrhoads/gu-psyc-347/issues/new?title=Issue%20on%20page%20%2Fsolutions/module-04-01_Prosocial-RL-Exercises-Solutions.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditions-blocks">
     4 conditions/blocks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#each-block-contains-24-trials">
     Each block contains 24 trials
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-output-key">
     Data output key
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specifying-plausible-models">
   Specifying plausible models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fitting-your-own-models">
     Fitting your own models!
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><a target="_blank" rel="noopener noreferrer" href="https://colab.research.google.com/github/shawnrhoads/gu-psyc-347/blob/master/docs/solutions/module-04-01_Prosocial-RL-Exercises-Solutions.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<div class="section" id="prosocial-rl-exercises-solutions">
<h1>Prosocial RL Exercises Solutions<a class="headerlink" href="#prosocial-rl-exercises-solutions" title="Permalink to this headline">¶</a></h1>
<p>We will now fit your behavioral data to the models developed during class (as well as a few others) and then compare the models to assess which model best explains the data. This exercise is a bit different from previous exercises. I will only provide you with minimal code/text to guide you through, but you should be able to complete it all on your own using the course resources, previous tutorials/exercises, previous papers, and previous lectures!</p>
<p><strong>Once you complete this exercise, you will be well on your way to becoming a pro computational modeler!</strong></p>
<hr width=50%><p>You can download the data from <a class="reference external" href="https://github.com/shawnrhoads/gu-psyc-347/tree/master/docs/static/data">GitHub</a> or by using the following code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import relevant modules</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span> <span class="c1"># finding optimal params in models</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>             <span class="c1"># statistical tools</span>
<span class="kn">import</span> <span class="nn">os</span>                           <span class="c1"># operating system tools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                  <span class="c1"># matrix/array functions</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                 <span class="c1"># loading and manipulating data</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>     <span class="c1"># plotting</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>                <span class="c1"># set seed for reproducibility</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this function will load the data into memory </span>
<span class="k">def</span> <span class="nf">load_subjects</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    input: n/a</span>
<span class="sd">    output: dictionary of DataFrames containing the data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;https://raw.githubusercontent.com/shawnrhoads/gu-psyc-347/master/docs/static/data/</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">_psyc-347-prosocial-learning.csv&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">)]</span>
        
    <span class="n">subject_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;subject&#39;</span><span class="p">)</span>
        <span class="n">subject_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;outcomeDescr&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;practice&#39;</span><span class="p">][[</span><span class="s1">&#39;block&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;trial_num&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;true_accuracy&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;outcome&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;outcomeDescr&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;cumulativePts_self&#39;</span><span class="p">,</span>
                                                                                  <span class="s1">&#39;cumulativePts_social&#39;</span><span class="p">]]</span>
        
    <span class="k">return</span> <span class="n">subject_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display data from first subject</span>
<span class="n">subject_data</span> <span class="o">=</span> <span class="n">load_subjects</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="conditions-blocks">
<h3>4 conditions/blocks<a class="headerlink" href="#conditions-blocks" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>self, win</p></li>
<li><p>self, avoid loss</p></li>
<li><p>social, win</p></li>
<li><p>social, avoid loss</p></li>
</ul>
</div>
<div class="section" id="each-block-contains-24-trials">
<h3>Each block contains 24 trials<a class="headerlink" href="#each-block-contains-24-trials" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>2 stimuli per trial (counterbalanced wrt side)</p></li>
<li><p>outcomes associated with each stimulus is probabilistic (75%, 25%)</p></li>
</ul>
</div>
<div class="section" id="data-output-key">
<h3>Data output key<a class="headerlink" href="#data-output-key" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">block</span></code>: (play for self to win); (play for self to avoid loss); (play for next student to win); (play for next student to avoid loss)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trial_num</span></code>: order in which trials are displayed within a block (0-23)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true_accuracy</span></code>: 1 if selected stimulus with highest probability of winning or avoid losing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outcome</span></code>: outcome for trial (<code class="docutils literal notranslate"><span class="pre">+1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">-1</span></code>); blank if missed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outcomeDescr</span></code>: text description of outcome (practice, social win, social avoid win, social loss, social avoid loss, self win, self avoid win, self loss, self avoid loss)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cumulativePts_self</span></code>: running total of points for self</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cumulativePts_social</span></code>: running total of points for social</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># view data from first subject</span>
<span class="n">display</span><span class="p">(</span><span class="n">subject_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>block</th>
      <th>trial_num</th>
      <th>true_accuracy</th>
      <th>outcome</th>
      <th>outcomeDescr</th>
      <th>cumulativePts_self</th>
      <th>cumulativePts_social</th>
    </tr>
    <tr>
      <th>subject</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>social_win</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>social avoid win</td>
      <td>1000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>social_win</td>
      <td>1</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>social win</td>
      <td>1000</td>
      <td>1100</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>social_win</td>
      <td>2</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>social win</td>
      <td>1000</td>
      <td>1200</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>social_win</td>
      <td>3</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>social win</td>
      <td>1000</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>social_win</td>
      <td>4</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>social avoid win</td>
      <td>1000</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>self_avoidloss</td>
      <td>19</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>self avoid loss</td>
      <td>2100</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>self_avoidloss</td>
      <td>20</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>self avoid loss</td>
      <td>2100</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>self_avoidloss</td>
      <td>21</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>self avoid loss</td>
      <td>2100</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>self_avoidloss</td>
      <td>22</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>self lose</td>
      <td>2000</td>
      <td>1300</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>self_avoidloss</td>
      <td>23</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>self lose</td>
      <td>1900</td>
      <td>1300</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we will need this function to grab indices of specific elements </span>
<span class="k">def</span> <span class="nf">get_index_positions</span><span class="p">(</span><span class="n">list_of_elems</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns the indexes of all occurrences of given element in</span>
<span class="sd">    the list- listOfElements &#39;&#39;&#39;</span>
    <span class="n">index_pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Search for item in list from indexPos to the end of list</span>
            <span class="n">index_pos</span> <span class="o">=</span> <span class="n">list_of_elems</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">index_pos</span><span class="p">)</span>
            <span class="c1"># Add the index position in list</span>
            <span class="n">index_pos_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_pos</span><span class="p">)</span>
            <span class="n">index_pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">break</span>
            
    <span class="k">return</span> <span class="n">index_pos_list</span>
</pre></div>
</div>
</div>
</div>
<hr></div>
</div>
<div class="section" id="specifying-plausible-models">
<h2>Specifying plausible models<a class="headerlink" href="#specifying-plausible-models" title="Permalink to this headline">¶</a></h2>
<p>Below we will begin to specify some plausible models to characterize behavior during the task. Typically, each of these models can be written as a <code class="docutils literal notranslate"><span class="pre">class</span></code> objects (see <a class="reference external" href="https://docs.python.org/3/tutorial/classes.html">Python Classes</a>) with <code class="docutils literal notranslate"><span class="pre">methods</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">model.fit()</span></code>), but we will use a more-procedural approach for clarity during these exercises.</p>
<p>This first model is a simple Rescorla-Wagner Model that ignores information that is socially-relevant (e.g., deciding self or other) or outcome-relevant (e.g., positive or negative outcomes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Completed Model 1</span>
<span class="k">def</span> <span class="nf">Simple_1a1t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inputs:</span>
<span class="sd">        - params: list of 2 guesses (float) for each parameter (alpha, theta)</span>
<span class="sd">        - choices: list of 96 choices (int) on each trial (0, 1)</span>
<span class="sd">        - outcomes: list of 96 outcomes (int) on each trial (-1, 0, 1)</span>
<span class="sd">        - block: list of 96 conditions (string) on each trial (self_win, self_avoidloss, social_win, social_avoidloss)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        - negLL: negative loglikelihood computed</span>
<span class="sd">                 from the choice probabilities (float)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">alpha</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">params</span> 
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span> <span class="c1"># check inputs</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># extracts list of four strings corresponding to conditions</span>
        <span class="n">unique_conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

        <span class="c1"># init choice probs</span>
        <span class="n">choiceProb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
        <span class="n">Q_out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">unique_conditions</span><span class="p">:</span>

            <span class="n">T_temp</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>    
            <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Q at trial 0</span>
            <span class="n">Q_stored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">T_temp</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 

            <span class="n">cur_indices</span> <span class="o">=</span> <span class="n">get_index_positions</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>

            <span class="c1"># check if self vs social</span>
            <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>                
            <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
            
            <span class="c1"># loop through trials within condition</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">):</span>       

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t update if nan</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute choice probabilities for k=2</span>
                    <span class="c1"># use the softmax rule</span>
                    <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    <span class="n">sum_ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">/</span> <span class="n">sum_ev</span>

                    <span class="c1"># compute choice probability for actual choice</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="c1"># update values</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>
                    <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">delta</span>

                    <span class="c1"># store Q_t+1</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">Q_out</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_stored</span>
            
        <span class="n">negLL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">choiceProb</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="c1">#plot mean across 4 blocks</span>
            <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Q across conditions&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">negLL</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test this function using a guess for <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">theta</span></code> for one subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use one subject (feel free to change)</span>
<span class="n">behavior</span> <span class="o">=</span> <span class="n">subject_data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> 

<span class="c1"># guess for alpha and theta</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.12</span><span class="p">,</span> <span class="mf">2.11</span><span class="p">]</span> 

<span class="c1"># specify subject data</span>
<span class="n">choices</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span>
<span class="n">outcomes</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span> 

<span class="c1"># compute negative log likelihood given</span>
<span class="c1"># data and guessed parameters</span>
<span class="n">subj_negll</span> <span class="o">=</span> <span class="n">Simple_1a1t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_15_0.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_15_0.png" />
</div>
</div>
<p>Now, let’s put this into a for-loop to minimize the negative log likelihood across all subjects.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize dataframe to store results</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;NLL&#39;</span><span class="p">])</span>

<span class="c1"># initialize list of algorithms </span>
<span class="c1"># (use one during class, but you can try a few others on your own)</span>
<span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">]</span> <span class="c1">#[&#39;Powell&#39;,&#39;TNC&#39;,&#39;SLSQP&#39;,&#39;trust-constr&#39;]</span>

<span class="c1"># loop through subjects</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

    <span class="c1"># gradient descent to minimize neg LL</span>
    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># set initial neg LL to be inf</span>

    <span class="c1"># guess several different starting points for alpha</span>
    <span class="k">for</span> <span class="n">alpha_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">theta_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>

            <span class="c1"># guesses for alpha, theta will change on each loop</span>
            <span class="n">init_guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_guess</span><span class="p">,</span> <span class="n">theta_guess</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>

                <span class="c1"># minimize neg LL</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">Simple_1a1t</span><span class="p">,</span>
                                  <span class="n">init_guess</span><span class="p">,</span>
                                  <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">),</span>
                                  <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                  <span class="n">method</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>

                <span class="c1"># if current negLL is smaller than the last negLL,</span>
                <span class="c1"># then store current data</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">res_nll</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                    <span class="n">param_fits</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># also, compute BIC</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">res_nll</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="c1">#store in dataframe</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;NLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_nll</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;BIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIC</span>

    <span class="c1"># print/plot Q values for subject   </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;subject </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">: alpha=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; negLL=</span><span class="si">{</span><span class="n">res_nll</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; BIC=</span><span class="si">{</span><span class="n">BIC</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nll</span> <span class="o">=</span> <span class="n">Simple_1a1t</span><span class="p">(</span><span class="n">param_fits</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 01: alpha=0.91, theta=3.13; negLL=41.24; BIC=91.60
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_1.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 02: alpha=0.03, theta=12.00; negLL=51.42; BIC=111.97
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_3.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 03: alpha=0.06, theta=12.00; negLL=41.13; BIC=91.39
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_5.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 04: alpha=0.00, theta=1.00; negLL=66.54; BIC=142.21
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_7.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 05: alpha=0.23, theta=7.15; negLL=35.25; BIC=79.63
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_9.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 06: alpha=0.44, theta=5.81; negLL=28.37; BIC=65.87
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_11.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 07: alpha=0.13, theta=12.00; negLL=19.16; BIC=47.44
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_13.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 08: alpha=0.16, theta=5.38; negLL=48.77; BIC=106.68
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_15.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 09: alpha=0.31, theta=7.58; negLL=28.84; BIC=66.80
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_17.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 10: alpha=0.31, theta=11.00; negLL=18.06; BIC=45.26
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_19.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 11: alpha=0.25, theta=12.00; negLL=12.57; BIC=34.26
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_21.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_17_21.png" />
</div>
</div>
<p>At a quick glance at the <strong>negative log likelihood</strong> and <strong>BIC</strong> values, we can see that this model performs better for some subjects relative to others. Some subjects even perform so poorly that we can’t estimate parameters for them. We can see this all at once in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> we created to store the outputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>theta</th>
      <th>NLL</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.910384</td>
      <td>3.125691</td>
      <td>41.235016</td>
      <td>91.598729</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.034217</td>
      <td>12.0</td>
      <td>51.419038</td>
      <td>111.966772</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.063137</td>
      <td>12.0</td>
      <td>41.131208</td>
      <td>91.391112</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>66.542129</td>
      <td>142.212955</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.234915</td>
      <td>7.149005</td>
      <td>35.249369</td>
      <td>79.627435</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.438106</td>
      <td>5.812433</td>
      <td>28.370059</td>
      <td>65.868814</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.129681</td>
      <td>12.0</td>
      <td>19.155706</td>
      <td>47.440108</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.163722</td>
      <td>5.379728</td>
      <td>48.774263</td>
      <td>106.677222</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.30879</td>
      <td>7.577299</td>
      <td>28.83555</td>
      <td>66.799797</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.305454</td>
      <td>11.001907</td>
      <td>18.063611</td>
      <td>45.255917</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.248679</td>
      <td>12.0</td>
      <td>12.56593</td>
      <td>34.260556</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<hr width=50%><p><strong>Let’s try a different model…</strong></p>
<p>Our task is very similar to the task used by <a class="reference external" href="https://doi.org/10.1073/pnas.1603198113">Lockwood et al. (2016)</a>. Think about how the authors modeled human social behavior in their task!</p>
<p>One variation included <code class="docutils literal notranslate"><span class="pre">learning</span> <span class="pre">rate</span></code> parameters (e.g., <code class="docutils literal notranslate"><span class="pre">alpha</span></code>) that indexed sensitivity to prediction errors for both (1) self (e.g., <code class="docutils literal notranslate"><span class="pre">alpha_self</span></code>) and (2) other (e.g., <code class="docutils literal notranslate"><span class="pre">alpha_other</span></code>). How about we try that for our data?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Social_2a1t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># 1 alpha_self + 1 alpha_other + 1 theta</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inputs:</span>
<span class="sd">        - params: list of 3 guesses (float) for each parameter (alpha_self, alpha_other, theta)</span>
<span class="sd">        - choices: list of 96 choices (int) on each trial (0, 1)</span>
<span class="sd">        - outcomes: list of 96 outcomes (int) on each trial (-1, 0, 1)</span>
<span class="sd">        - block: list of 96 conditions (string) on each trial (self_win, self_avoidloss, social_win, social_avoidloss)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        - negLL: negative loglikelihood computed</span>
<span class="sd">                 from the choice probabilities (float)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">alpha_self</span><span class="p">,</span> <span class="n">alpha_other</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">params</span> 
    
    <span class="c1"># check inputs</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_self</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_other</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># extracts list of four strings corresponding to conditions</span>
        <span class="n">unique_conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

        <span class="c1"># init choice probs</span>
        <span class="n">choiceProb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
        <span class="n">Q_out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">unique_conditions</span><span class="p">:</span>

            <span class="n">T_temp</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>    
            <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Q at trial 0</span>
            <span class="n">Q_stored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">T_temp</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 

            <span class="n">cur_indices</span> <span class="o">=</span> <span class="n">get_index_positions</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>

            <span class="c1"># check if self vs social</span>
            <span class="c1">#    Note: this bulky if-statement</span>
            <span class="c1">#    is intentional to make it clear</span>
            <span class="c1">#    what we are doing</span>
            <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span> 
                
            <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
            
            <span class="c1"># loop through trials within condition</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">):</span>       

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t update if nan </span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute choice probabilities for k=2</span>
                    <span class="c1"># use the softmax rule</span>
                    <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    <span class="n">sum_ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">/</span> <span class="n">sum_ev</span>

                    <span class="c1"># compute choice probability for actual choice</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="c1"># update values</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>
                    
                    <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_self</span> <span class="o">*</span> <span class="n">delta</span>
                    <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_other</span> <span class="o">*</span> <span class="n">delta</span>

                    <span class="c1"># store Q_t+1</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">Q_out</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_stored</span>
            
        <span class="n">negLL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">choiceProb</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="c1">#plot mean across 4 blocks</span>
            <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Q across conditions&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">negLL</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s put this into a for-loop to minimize the negative log likelihood across all subjects.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize dataframe to store results</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;NLL&#39;</span><span class="p">])</span>

<span class="c1"># initialize list of algorithms </span>
<span class="c1"># (use one during class, but you can try a few others on your own)</span>
<span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">]</span> <span class="c1">#[&#39;Powell&#39;,&#39;TNC&#39;,&#39;SLSQP&#39;,&#39;trust-constr&#39;]</span>

<span class="c1"># loop through subjects</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

    <span class="c1"># gradient descent to minimize neg LL</span>
    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># set initial neg LL to be inf</span>

    <span class="c1"># guess several different starting points for alpha</span>
    <span class="k">for</span> <span class="n">alpha_self_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">alpha_other_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">theta_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>

                <span class="c1"># guesses for alpha, theta will change on each loop</span>
                <span class="n">init_guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_self_guess</span><span class="p">,</span> <span class="n">alpha_other_guess</span><span class="p">,</span> <span class="n">theta_guess</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>

                    <span class="c1"># minimize neg LL</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">Social_2a1t</span><span class="p">,</span>
                                      <span class="n">init_guess</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">),</span>
                                      <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                      <span class="n">method</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>

                    <span class="c1"># if current negLL is smaller than the last negLL,</span>
                    <span class="c1"># then store current data</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">res_nll</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                        <span class="n">res_nll</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                        <span class="n">param_fits</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># also, compute BIC</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">res_nll</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="c1">#store in dataframe</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;NLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_nll</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;BIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIC</span>

    <span class="c1"># print/plot Q values for subject   </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;subject </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">: alpha_self=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_other=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; negLL=</span><span class="si">{</span><span class="n">res_nll</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; BIC=</span><span class="si">{</span><span class="n">BIC</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nll</span> <span class="o">=</span> <span class="n">Social_2a1t</span><span class="p">(</span><span class="n">param_fits</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 01: alpha_self=0.76, alpha_other=1.00, theta=3.30; negLL=40.68; BIC=95.06
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_1.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 02: alpha_self=0.08, alpha_other=0.02, theta=12.00; negLL=46.42; BIC=106.53
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_3.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 03: alpha_self=0.11, alpha_other=0.04, theta=12.00; negLL=38.84; BIC=91.38
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_5.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 04: alpha_self=0.00, alpha_other=0.00, theta=12.00; negLL=66.41; BIC=146.51
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_7.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 05: alpha_self=0.26, alpha_other=0.18, theta=7.69; negLL=35.02; BIC=83.73
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_9.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 06: alpha_self=0.30, alpha_other=0.65, theta=6.24; negLL=27.35; BIC=68.39
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_11.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 07: alpha_self=0.14, alpha_other=0.12, theta=12.00; negLL=19.08; BIC=51.85
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_13.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 08: alpha_self=0.16, alpha_other=0.69, theta=3.99; negLL=47.11; BIC=107.91
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_15.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 09: alpha_self=0.42, alpha_other=0.24, theta=7.91; negLL=28.21; BIC=70.12
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_17.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 10: alpha_self=0.29, alpha_other=0.80, theta=12.00; negLL=17.71; BIC=49.11
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_19.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 11: alpha_self=0.33, alpha_other=0.20, theta=12.00; negLL=12.02; BIC=37.74
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_21.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_24_21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>theta</th>
      <th>NLL</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.760689</td>
      <td>1.0</td>
      <td>40.681883</td>
      <td>95.056810</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.081382</td>
      <td>0.015783</td>
      <td>46.417372</td>
      <td>106.527788</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.107811</td>
      <td>0.037979</td>
      <td>38.844495</td>
      <td>91.382034</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.003832</td>
      <td>66.406572</td>
      <td>146.506188</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.260908</td>
      <td>0.175293</td>
      <td>35.018243</td>
      <td>83.729531</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.296518</td>
      <td>0.651074</td>
      <td>27.348106</td>
      <td>68.389257</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.139729</td>
      <td>0.11758</td>
      <td>19.077929</td>
      <td>51.848903</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.160885</td>
      <td>0.688449</td>
      <td>47.106963</td>
      <td>107.906970</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.424338</td>
      <td>0.242731</td>
      <td>28.212399</td>
      <td>70.117842</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.285959</td>
      <td>0.801353</td>
      <td>17.710507</td>
      <td>49.114059</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.326473</td>
      <td>0.201148</td>
      <td>12.022076</td>
      <td>37.737196</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What do we think? At a glance, do we think this model was better at characterizing the behavior?</p>
<hr><div class="section" id="fitting-your-own-models">
<h3>Fitting your own models!<a class="headerlink" href="#fitting-your-own-models" title="Permalink to this headline">¶</a></h3>
<p>Now, we will split into our groups (3-4 students per group) to brainstorm other plausible models and then collaboratively write code to fit the data to these new models!</p>
<p>Here are some hints/ideas:</p>
<ul class="simple">
<li><p>Think <a class="reference external" href="https://doi.org/10.1073/pnas.1603198113">Lockwood et al. (2016)</a>! The authors had more than one <code class="docutils literal notranslate"><span class="pre">learning</span> <span class="pre">rate</span></code>. What else did they include in their best-fitting model? Why?</p></li>
<li><p>What else is different about this task? Do participants always “play to win” like they do in <a class="reference external" href="https://doi.org/10.1073/pnas.1603198113">Lockwood et al. (2016)</a>? What other conditions are there?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model 3(12 out of 30 points)</span>
<span class="k">def</span> <span class="nf">Valence_2a1t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># 1 alpha_positive + 1 alpha_negative + 1 theta</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inputs:</span>
<span class="sd">        - params: list of 3 guesses (float) for each parameter (alpha, theta)</span>
<span class="sd">        - choices: list of 96 choices (int) on each trial (0, 1)</span>
<span class="sd">        - outcomes: list of 96 outcomes (int) on each trial (-1, 0, 1)</span>
<span class="sd">        - block: list of 96 conditions (string) on each trial (self_win, self_avoidloss, social_win, social_avoidloss)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        - negLL: negative loglikelihood computed</span>
<span class="sd">                 from the choice probabilities (float)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">alpha_positive</span><span class="p">,</span> <span class="n">alpha_negative</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">params</span> 
    <span class="c1"># check inputs</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_positive</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_negative</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># extracts list of four strings corresponding to conditions</span>
        <span class="n">unique_conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

        <span class="c1"># init choice probs</span>
        <span class="n">choiceProb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
        <span class="n">Q_out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">unique_conditions</span><span class="p">:</span>

            <span class="n">T_temp</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>    
            <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Q at trial 0</span>
            <span class="n">Q_stored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">T_temp</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 

            <span class="n">cur_indices</span> <span class="o">=</span> <span class="n">get_index_positions</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>

            <span class="c1"># check if positive vs negative</span>
            <span class="c1">#    Note: this bulky if-statement</span>
            <span class="c1">#    is intentional to make it clear</span>
            <span class="c1">#    what we are doing</span>
            <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span> 
                
            <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
            
            <span class="c1"># loop through trials within condition</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">):</span>       

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t update if nan </span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute choice probabilities for k=2</span>
                    <span class="c1"># use the softmax rule</span>
                    <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    <span class="n">sum_ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">/</span> <span class="n">sum_ev</span>

                    <span class="c1"># compute choice probability for actual choice</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="c1"># update values</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>
                    
                    <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_positive</span> <span class="o">*</span> <span class="n">delta</span>
                    <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_negative</span> <span class="o">*</span> <span class="n">delta</span>

                    <span class="c1"># store Q_t+1</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">Q_out</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_stored</span>
            
        <span class="n">negLL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">choiceProb</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="c1">#plot mean across 4 blocks</span>
            <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Q across conditions&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">negLL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize dataframe to store results</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha_pos&#39;</span><span class="p">,</span><span class="s1">&#39;alpha_neg&#39;</span><span class="p">,</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;NLL&#39;</span><span class="p">,</span><span class="s1">&#39;BIC&#39;</span><span class="p">])</span>

<span class="c1"># initialize list of algorithms </span>
<span class="c1"># (use one during class, but you can try a few others on your own)</span>
<span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">]</span> <span class="c1">#[&#39;Powell&#39;,&#39;TNC&#39;,&#39;SLSQP&#39;,&#39;trust-constr&#39;]</span>

<span class="c1"># loop through subjects</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

    <span class="c1"># gradient descent to minimize neg LL</span>
    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># set initial neg LL to be inf</span>

    <span class="c1"># guess several different starting points for alpha</span>
    <span class="k">for</span> <span class="n">alpha_pos_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">alpha_neg_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">theta_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>

                <span class="c1"># guesses for alpha, theta will change on each loop</span>
                <span class="n">init_guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_pos_guess</span><span class="p">,</span> <span class="n">alpha_neg_guess</span><span class="p">,</span> <span class="n">theta_guess</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>

                    <span class="c1"># minimize neg LL</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">Valence_2a1t</span><span class="p">,</span>
                                      <span class="n">init_guess</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">),</span>
                                      <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                      <span class="n">method</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>

                    <span class="c1"># if current negLL is smaller than the last negLL,</span>
                    <span class="c1"># then store current data</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">res_nll</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                        <span class="n">res_nll</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                        <span class="n">param_fits</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># also, compute BIC</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">res_nll</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="c1">#store in dataframe</span>
    <span class="n">df3</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df3</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df3</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">df3</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;NLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_nll</span>
    <span class="n">df3</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;BIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIC</span>

    <span class="c1"># print/plot Q values for subject   </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;subject </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">: alpha_pos=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_neg=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; negLL=</span><span class="si">{</span><span class="n">res_nll</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; BIC=</span><span class="si">{</span><span class="n">BIC</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nll</span> <span class="o">=</span> <span class="n">Valence_2a1t</span><span class="p">(</span><span class="n">param_fits</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 01: alpha_pos=0.65, alpha_neg=1.00, theta=3.63; negLL=40.13; BIC=93.96
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_1.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 02: alpha_pos=0.04, alpha_neg=0.03, theta=12.00; negLL=51.40; BIC=116.50
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_3.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 03: alpha_pos=0.14, alpha_neg=0.03, theta=12.00; negLL=36.22; BIC=86.14
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_5.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 04: alpha_pos=0.00, alpha_neg=0.00, theta=1.00; negLL=66.54; BIC=146.78
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_7.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 05: alpha_pos=0.21, alpha_neg=0.39, theta=6.86; negLL=34.70; BIC=83.10
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_9.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 06: alpha_pos=0.25, alpha_neg=0.77, theta=7.09; negLL=26.24; BIC=66.17
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_11.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 07: alpha_pos=0.14, alpha_neg=0.12, theta=12.00; negLL=19.10; BIC=51.89
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_13.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 08: alpha_pos=1.00, alpha_neg=0.22, theta=3.18; negLL=46.58; BIC=106.85
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_15.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 09: alpha_pos=0.19, alpha_neg=0.43, theta=8.11; negLL=27.76; BIC=69.20
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_17.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 10: alpha_pos=0.24, alpha_neg=0.53, theta=11.22; negLL=17.33; BIC=48.35
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_19.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 11: alpha_pos=0.26, alpha_neg=0.24, theta=12.00; negLL=12.55; BIC=38.79
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_21.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_30_21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha_pos</th>
      <th>alpha_neg</th>
      <th>theta</th>
      <th>NLL</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.648875</td>
      <td>1.0</td>
      <td>3.633796</td>
      <td>40.134944</td>
      <td>93.962933</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.035713</td>
      <td>0.032702</td>
      <td>12.0</td>
      <td>51.401781</td>
      <td>116.496607</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.144034</td>
      <td>0.032195</td>
      <td>12.0</td>
      <td>36.224567</td>
      <td>86.142178</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>66.542129</td>
      <td>146.777303</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.208246</td>
      <td>0.391592</td>
      <td>6.86147</td>
      <td>34.704541</td>
      <td>83.102127</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.2497</td>
      <td>0.76605</td>
      <td>7.090218</td>
      <td>26.236052</td>
      <td>66.165148</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.139313</td>
      <td>0.119977</td>
      <td>12.0</td>
      <td>19.098325</td>
      <td>51.889695</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>0.224598</td>
      <td>3.181657</td>
      <td>46.578693</td>
      <td>106.85043</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.185241</td>
      <td>0.430937</td>
      <td>8.112291</td>
      <td>27.755787</td>
      <td>69.204618</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.240672</td>
      <td>0.533452</td>
      <td>11.220255</td>
      <td>17.326881</td>
      <td>48.346807</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.264419</td>
      <td>0.240717</td>
      <td>12.0</td>
      <td>12.548372</td>
      <td>38.789789</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Model 4 (12 out of 30 points)</span>
<span class="k">def</span> <span class="nf">Social_2a2t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># 1 alpha_self + 1 alpha_other + 1 theta_self + 1 theta_other</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inputs:</span>
<span class="sd">        - params: list of 4 guesses (float) for each parameter </span>
<span class="sd">                (alpha_self, alpha_other, theta_self, theta_other)</span>
<span class="sd">        - choices: list of 96 choices (int) on each trial (0, 1)</span>
<span class="sd">        - outcomes: list of 96 outcomes (int) on each trial (-1, 0, 1)</span>
<span class="sd">        - block: list of 96 conditions (string) on each trial (self_win, self_avoidloss, social_win, social_avoidloss)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        - negLL: negative loglikelihood computed</span>
<span class="sd">                 from the choice probabilities (float)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">alpha_self</span><span class="p">,</span> <span class="n">alpha_other</span><span class="p">,</span> <span class="n">theta_self</span><span class="p">,</span> <span class="n">theta_other</span> <span class="o">=</span> <span class="n">params</span> 
    
    <span class="c1"># check inputs</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_self</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_other</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta_self</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta_other</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># extracts list of four strings corresponding to conditions</span>
        <span class="n">unique_conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

        <span class="c1"># init choice probs</span>
        <span class="n">choiceProb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
        <span class="n">Q_out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">unique_conditions</span><span class="p">:</span>

            <span class="n">T_temp</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>    
            <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Q at trial 0</span>
            <span class="n">Q_stored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">T_temp</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 

            <span class="n">cur_indices</span> <span class="o">=</span> <span class="n">get_index_positions</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>

            <span class="c1"># check if self vs social</span>
            <span class="c1">#    Note: this bulky if-statement</span>
            <span class="c1">#    is intentional to make it clear</span>
            <span class="c1">#    what we are doing</span>
            <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span> 
                
            <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
            
            <span class="c1"># loop through trials within condition</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">):</span>       

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t update if nan</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute choice probabilities for k=2</span>
                    <span class="c1"># use the softmax rule</span>
                    <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta_self</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta_other</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    
                    <span class="n">sum_ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">/</span> <span class="n">sum_ev</span>

                    <span class="c1"># compute choice probability for actual choice</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="c1"># update values</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>
                    
                    <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_self</span> <span class="o">*</span> <span class="n">delta</span>
                    <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_other</span> <span class="o">*</span> <span class="n">delta</span>

                    <span class="c1"># store Q_t+1</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">Q_out</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_stored</span>
            
        <span class="n">negLL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">choiceProb</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="c1">#plot mean across 4 blocks</span>
            <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Q across conditions&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">negLL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize dataframe to store results</span>
<span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha_self&#39;</span><span class="p">,</span><span class="s1">&#39;alpha_other&#39;</span><span class="p">,</span><span class="s1">&#39;theta_self&#39;</span><span class="p">,</span><span class="s1">&#39;theta_other&#39;</span><span class="p">,</span><span class="s1">&#39;NLL&#39;</span><span class="p">,</span><span class="s1">&#39;BIC&#39;</span><span class="p">])</span>

<span class="c1"># initialize list of algorithms </span>
<span class="c1"># (use one during class, but you can try a few others on your own)</span>
<span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">]</span> <span class="c1">#[&#39;Powell&#39;,&#39;TNC&#39;,&#39;SLSQP&#39;,&#39;trust-constr&#39;]</span>

<span class="c1"># loop through subjects</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

    <span class="c1"># gradient descent to minimize neg LL</span>
    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># set initial neg LL to be inf</span>

    <span class="c1"># guess several different starting points for alpha</span>
    <span class="k">for</span> <span class="n">alpha_self_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">alpha_other_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">theta_self_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">theta_other_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>

                    <span class="c1"># guesses for alpha, theta will change on each loop</span>
                    <span class="n">init_guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_self_guess</span><span class="p">,</span> <span class="n">alpha_other_guess</span><span class="p">,</span> <span class="n">theta_self_guess</span><span class="p">,</span> <span class="n">theta_other_guess</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>

                        <span class="c1"># minimize neg LL</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">Social_2a2t</span><span class="p">,</span>
                                          <span class="n">init_guess</span><span class="p">,</span>
                                          <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">),</span>
                                          <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                          <span class="n">method</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>

                        <span class="c1"># if current negLL is smaller than the last negLL,</span>
                        <span class="c1"># then store current data</span>
                        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">res_nll</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                            <span class="n">res_nll</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                            <span class="n">param_fits</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># also, compute BIC</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">res_nll</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="c1">#store in dataframe</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_self&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta_self&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta_other&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;NLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_nll</span>
    <span class="n">df4</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;BIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIC</span>

    <span class="c1"># print/plot Q values for subject   </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;subject </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">: alpha_self=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_other=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta_self=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta_other=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; negLL=</span><span class="si">{</span><span class="n">res_nll</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; BIC=</span><span class="si">{</span><span class="n">BIC</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nll</span> <span class="o">=</span> <span class="n">Social_2a2t</span><span class="p">(</span><span class="n">param_fits</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 01: alpha_self=0.64, alpha_other=1.00, theta_self=4.72, theta_other=2.61; negLL=39.76; BIC=97.78
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_1.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 02: alpha_self=0.08, alpha_other=0.02, theta_self=12.00, theta_other=12.00; negLL=46.42; BIC=111.09
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_3.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 03: alpha_self=0.11, alpha_other=0.46, theta_self=12.00, theta_other=3.21; negLL=37.07; BIC=92.40
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_5.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 04: alpha_self=0.00, alpha_other=0.00, theta_self=12.00, theta_other=12.00; negLL=66.41; BIC=151.07
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_7.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 05: alpha_self=0.26, alpha_other=0.20, theta_self=8.13, theta_other=6.87; negLL=34.96; BIC=88.19
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_9.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 06: alpha_self=0.31, alpha_other=0.65, theta_self=5.98, theta_other=6.47; negLL=27.33; BIC=72.93
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_11.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 07: alpha_self=0.14, alpha_other=0.12, theta_self=12.00, theta_other=12.00; negLL=19.08; BIC=56.41
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_13.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 08: alpha_self=0.04, alpha_other=0.78, theta_self=12.00, theta_other=3.13; negLL=45.80; BIC=109.86
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_15.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 09: alpha_self=0.47, alpha_other=0.19, theta_self=5.21, theta_other=12.00; negLL=24.89; BIC=68.03
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_17.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 10: alpha_self=0.29, alpha_other=0.56, theta_self=12.00, theta_other=8.34; negLL=17.49; BIC=53.24
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_19.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 11: alpha_self=0.33, alpha_other=0.20, theta_self=12.00, theta_other=12.00; negLL=12.02; BIC=42.30
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_21.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_33_21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha_self</th>
      <th>alpha_other</th>
      <th>theta_self</th>
      <th>theta_other</th>
      <th>NLL</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.64041</td>
      <td>1.0</td>
      <td>4.719064</td>
      <td>2.606712</td>
      <td>39.75991</td>
      <td>97.777213</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.081382</td>
      <td>0.015783</td>
      <td>12.0</td>
      <td>12.0</td>
      <td>46.417372</td>
      <td>111.092136</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.107811</td>
      <td>0.462793</td>
      <td>12.0</td>
      <td>3.211915</td>
      <td>37.072458</td>
      <td>92.402308</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.003832</td>
      <td>12.0</td>
      <td>12.0</td>
      <td>66.406572</td>
      <td>151.070536</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.256449</td>
      <td>0.204543</td>
      <td>8.127817</td>
      <td>6.870225</td>
      <td>34.964606</td>
      <td>88.186605</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.310434</td>
      <td>0.651042</td>
      <td>5.983929</td>
      <td>6.46816</td>
      <td>27.334393</td>
      <td>72.926178</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.139729</td>
      <td>0.11758</td>
      <td>12.0</td>
      <td>12.0</td>
      <td>19.077929</td>
      <td>56.413251</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.042555</td>
      <td>0.779956</td>
      <td>12.0</td>
      <td>3.132528</td>
      <td>45.800017</td>
      <td>109.857427</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.474939</td>
      <td>0.187772</td>
      <td>5.210771</td>
      <td>12.0</td>
      <td>24.885691</td>
      <td>68.028775</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.285959</td>
      <td>0.559895</td>
      <td>12.0</td>
      <td>8.336169</td>
      <td>17.489508</td>
      <td>53.236408</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.326473</td>
      <td>0.201148</td>
      <td>12.0</td>
      <td>12.0</td>
      <td>12.022076</td>
      <td>42.301544</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bonus Model 5 (not required for exercise)</span>
<span class="k">def</span> <span class="nf">SocialValence_4a1t</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># 1 alpha_self_pos + 1 alpha_self_neg +</span>
    <span class="c1"># 1 alpha_other_pos + 1 alpha_other_neg + 1 theta</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inputs:</span>
<span class="sd">        - params: list of 5 guesses (float) for each parameter </span>
<span class="sd">                    alpha_self_pos</span>
<span class="sd">                    alpha_self_neg</span>
<span class="sd">                    alpha_other_pos</span>
<span class="sd">                    alpha_other_neg</span>
<span class="sd">                    theta</span>
<span class="sd">        - choices: list of 96 choices (int) on each trial (0, 1)</span>
<span class="sd">        - outcomes: list of 96 outcomes (int) on each trial (-1, 0, 1)</span>
<span class="sd">        - block: list of 96 conditions (string) on each trial (self_win, self_avoidloss, social_win, social_avoidloss)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        - negLL: negative loglikelihood computed</span>
<span class="sd">                 from the choice probabilities (float)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">alpha_self_pos</span><span class="p">,</span> <span class="n">alpha_self_neg</span><span class="p">,</span> <span class="n">alpha_other_pos</span><span class="p">,</span> <span class="n">alpha_other_neg</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">params</span> 
    
    <span class="c1"># check inputs</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_self_pos</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_self_neg</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_other_pos</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">alpha_other_neg</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># extracts list of four strings corresponding to conditions</span>
        <span class="n">unique_conditions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

        <span class="c1"># init choice probs</span>
        <span class="n">choiceProb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
        <span class="n">Q_out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">unique_conditions</span><span class="p">:</span>

            <span class="n">T_temp</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>    
            <span class="n">Q</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span> <span class="c1"># Q at trial 0</span>
            <span class="n">Q_stored</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">T_temp</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 

            <span class="n">cur_indices</span> <span class="o">=</span> <span class="n">get_index_positions</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)[</span><span class="n">cur_indices</span><span class="p">]</span>

            <span class="c1"># check if self vs social</span>
            <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span> 
                
                
            <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                <span class="c1"># check if win vs avoid loss</span>
                <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
            
            <span class="c1"># loop through trials within condition</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">):</span>       

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t update if nan</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute choice probabilities for k=2</span>
                    <span class="c1"># use the softmax rule</span>
                    <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
                    <span class="n">sum_ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">ev</span> <span class="o">/</span> <span class="n">sum_ev</span>

                    <span class="c1"># compute choice probability for actual choice</span>
                    <span class="n">choiceProb</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="c1"># update values</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span>

                    <span class="k">if</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_self_pos</span> <span class="o">*</span> <span class="n">delta</span>
                        <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_self_neg</span> <span class="o">*</span> <span class="n">delta</span>

                    <span class="k">elif</span> <span class="s1">&#39;social&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;win&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_other_pos</span> <span class="o">*</span> <span class="n">delta</span>
                        <span class="k">elif</span> <span class="s1">&#39;avoidloss&#39;</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">t</span><span class="p">])]</span> <span class="o">+</span> <span class="n">alpha_other_neg</span> <span class="o">*</span> <span class="n">delta</span>                    

                    <span class="c1"># store Q_t+1</span>
                    <span class="n">Q_stored</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">Q_out</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q_stored</span>
            
        <span class="n">negLL</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">choiceProb</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="c1">#plot mean across 4 blocks</span>
            <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_win&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;self_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Q_out</span><span class="p">[</span><span class="s1">&#39;social_avoidloss&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T_temp</span><span class="p">),</span><span class="n">Q1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Q across conditions&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">negLL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize dataframe to store results</span>
<span class="n">df5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha_self_pos&#39;</span><span class="p">,</span><span class="s1">&#39;alpha_self_neg&#39;</span><span class="p">,</span><span class="s1">&#39;alpha_other_pos&#39;</span><span class="p">,</span><span class="s1">&#39;alpha_other_neg&#39;</span><span class="p">,</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="s1">&#39;NLL&#39;</span><span class="p">,</span><span class="s1">&#39;BIC&#39;</span><span class="p">])</span>

<span class="c1"># initialize list of algorithms </span>
<span class="c1"># (use one during class, but you can try a few others on your own)</span>
<span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">]</span> <span class="c1">#[&#39;Powell&#39;,&#39;TNC&#39;,&#39;SLSQP&#39;,&#39;trust-constr&#39;]</span>

<span class="c1"># loop through subjects</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">true_accuracy</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">behavior</span><span class="o">.</span><span class="n">block</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

    <span class="c1"># gradient descent to minimize neg LL</span>
    <span class="n">res_nll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># set initial neg LL to be inf</span>

    <span class="c1"># guess several different starting points for alpha, theta</span>
    <span class="c1"># (doing less here because the search space is so large!)</span>
    <span class="k">for</span> <span class="n">alpha_self_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">alpha_other_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">theta_guess</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>

                <span class="c1"># guesses for alpha, theta will change on each loop</span>
                <span class="n">init_guess</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_self_guess</span><span class="p">,</span> <span class="n">alpha_other_guess</span><span class="p">,</span> <span class="n">alpha_self_guess</span><span class="p">,</span> <span class="n">alpha_other_guess</span><span class="p">,</span> <span class="n">theta_guess</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>

                    <span class="c1"># minimize neg LL</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">SocialValence_4a1t</span><span class="p">,</span>
                                      <span class="n">init_guess</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">),</span>
                                      <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                      <span class="n">method</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>

                    <span class="c1"># if current negLL is smaller than the last negLL,</span>
                    <span class="c1"># then store current data</span>
                    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">res_nll</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                        <span class="n">res_nll</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
                        <span class="n">param_fits</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>

    <span class="c1"># also, compute BIC</span>
    <span class="n">BIC</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">res_nll</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="c1">#store in dataframe</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_self_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_self_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_other_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;alpha_other_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_fits</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;NLL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_nll</span>
    <span class="n">df5</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;BIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIC</span>

    <span class="c1"># print/plot Q values for subject   </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;subject </span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">: alpha_self_pos=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_self_neg=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_other_pos=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, alpha_other_neg=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, theta=</span><span class="si">{</span><span class="n">param_fits</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; negLL=</span><span class="si">{</span><span class="n">res_nll</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; BIC=</span><span class="si">{</span><span class="n">BIC</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nll</span> <span class="o">=</span> <span class="n">SocialValence_4a1t</span><span class="p">(</span><span class="n">param_fits</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 01: alpha_self_pos=0.32, alpha_self_neg=0.98, alpha_other_pos=0.02, alpha_other_neg=1.00, theta=9.44; negLL=38.02; BIC=98.85
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_1.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 02: alpha_self_pos=0.12, alpha_self_neg=0.07, alpha_other_pos=0.01, alpha_other_neg=0.02, theta=12.00; negLL=46.04; BIC=114.91
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_3.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 03: alpha_self_pos=0.14, alpha_self_neg=0.08, alpha_other_pos=0.15, alpha_other_neg=0.01, theta=12.00; negLL=33.46; BIC=89.74
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_5.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 04: alpha_self_pos=0.00, alpha_self_neg=0.00, alpha_other_pos=0.00, alpha_other_neg=0.01, theta=12.00; negLL=66.25; BIC=155.32
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_7.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 05: alpha_self_pos=0.25, alpha_self_neg=0.32, alpha_other_pos=0.12, alpha_other_neg=0.34, theta=7.99; negLL=34.10; BIC=91.02
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_9.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 06: alpha_self_pos=0.12, alpha_self_neg=0.63, alpha_other_pos=0.39, alpha_other_neg=0.85, theta=8.01; negLL=25.12; BIC=73.05
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_11.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_11.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 07: alpha_self_pos=0.14, alpha_self_neg=0.14, alpha_other_pos=0.14, alpha_other_neg=0.10, theta=12.00; negLL=18.93; BIC=60.69
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_13.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_13.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 08: alpha_self_pos=0.03, alpha_self_neg=0.14, alpha_other_pos=0.48, alpha_other_neg=0.04, theta=9.78; negLL=44.02; BIC=110.86
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_15.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_15.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 09: alpha_self_pos=0.50, alpha_self_neg=0.38, alpha_other_pos=0.18, alpha_other_neg=0.62, theta=8.13; negLL=26.99; BIC=76.79
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_17.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 10: alpha_self_pos=0.23, alpha_self_neg=0.56, alpha_other_pos=0.89, alpha_other_neg=0.29, theta=12.00; negLL=16.22; BIC=55.26
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_19.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_19.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>subject 11: alpha_self_pos=0.23, alpha_self_neg=0.40, alpha_other_pos=0.31, alpha_other_neg=0.16, theta=12.00; negLL=11.30; BIC=45.42
</pre></div>
</div>
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_21.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_36_21.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha_self_pos</th>
      <th>alpha_self_neg</th>
      <th>alpha_other_pos</th>
      <th>alpha_other_neg</th>
      <th>theta</th>
      <th>NLL</th>
      <th>BIC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.320348</td>
      <td>0.978904</td>
      <td>0.023847</td>
      <td>1.0</td>
      <td>9.437493</td>
      <td>38.016359</td>
      <td>98.854458</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.11808</td>
      <td>0.065096</td>
      <td>0.014785</td>
      <td>0.016731</td>
      <td>12.0</td>
      <td>46.042017</td>
      <td>114.905776</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.139103</td>
      <td>0.081481</td>
      <td>0.152275</td>
      <td>0.01182</td>
      <td>12.0</td>
      <td>33.457502</td>
      <td>89.736745</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.007885</td>
      <td>12.0</td>
      <td>66.247088</td>
      <td>155.315916</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.2519</td>
      <td>0.318756</td>
      <td>0.116209</td>
      <td>0.342456</td>
      <td>7.985729</td>
      <td>34.10134</td>
      <td>91.024422</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.116973</td>
      <td>0.634377</td>
      <td>0.385897</td>
      <td>0.849267</td>
      <td>8.011112</td>
      <td>25.116216</td>
      <td>73.054172</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.139103</td>
      <td>0.140344</td>
      <td>0.139586</td>
      <td>0.098146</td>
      <td>12.0</td>
      <td>18.933282</td>
      <td>60.688305</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.030877</td>
      <td>0.139475</td>
      <td>0.480044</td>
      <td>0.038782</td>
      <td>9.780298</td>
      <td>44.018283</td>
      <td>110.858306</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.502454</td>
      <td>0.381941</td>
      <td>0.184442</td>
      <td>0.616257</td>
      <td>8.130312</td>
      <td>26.986115</td>
      <td>76.793971</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.226649</td>
      <td>0.556591</td>
      <td>0.887385</td>
      <td>0.294739</td>
      <td>12.0</td>
      <td>16.218402</td>
      <td>55.258546</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.229854</td>
      <td>0.403204</td>
      <td>0.308511</td>
      <td>0.163654</td>
      <td>12.0</td>
      <td>11.301063</td>
      <td>45.423867</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, we should have run 3-4 models that we can compare to assess which model might explain the data best. Remember we store the parameter fits in Pandas DataFrames: <code class="docutils literal notranslate"><span class="pre">df1</span></code>, <code class="docutils literal notranslate"><span class="pre">df2</span></code>, <code class="docutils literal notranslate"><span class="pre">df3</span></code>, <code class="docutils literal notranslate"><span class="pre">df4</span></code>, and maybe <code class="docutils literal notranslate"><span class="pre">df5</span></code> (if you completed the bonus).</p>
<p>Let’s use this information to compute Bayesian Information Criterion (<span class="math notranslate nohighlight">\(BIC\)</span>) across subjects for each model. One way in which we can do so is by summing the negative log likelihoods across subjects for each model and using that value to compute a <span class="math notranslate nohighlight">\(BIC\)</span> score. Then, we can plot each <span class="math notranslate nohighlight">\(BIC\)</span> to assess model fits. Please do this below.</p>
<p><em><strong>Hints</strong></em></p>
<ul class="simple">
<li><p>to compute the sum of the negative likelihoods for the first model, you would use the command: <code class="docutils literal notranslate"><span class="pre">np.nansum(df1['NLL'].values)</span></code>.</p></li>
<li><p>You can refer to <a class="reference external" href="https://shawnrhoads.github.io/gu-psyc-347/module-02-01_Nonlinear-Modeling.html#model-comparison">this page</a> to review Bayesian Information Criterion (<span class="math notranslate nohighlight">\(BIC\)</span>), but note that tutorial used <span class="math notranslate nohighlight">\(MSE\)</span> to compute the <span class="math notranslate nohighlight">\(BIC\)</span>. Here, we will use the negative loglikelihood (like <a class="reference external" href="https://shawnrhoads.github.io/gu-psyc-347/module-03-01_Models-of-Learning.html#gradient-descent">in this tutorial</a>). Therefore, we won’t need to multiply by a <span class="math notranslate nohighlight">\(-1\)</span>! Also, remember to factor in the number of free parameters in each of your models!</p></li>
<li><p>Remember we will have 4-5 <span class="math notranslate nohighlight">\(BIC\)</span> values by the end of this tutorial.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute BIC for each Model and Plot (6 out of 30 points)</span>
<span class="k">def</span> <span class="nf">calculate_bic</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nll</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">nll</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_params</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bic</span>

<span class="k">def</span> <span class="nf">plot_bic</span><span class="p">(</span><span class="n">list_of_dfs</span><span class="p">,</span> <span class="n">list_of_num_params</span><span class="p">,</span> <span class="n">df_names</span><span class="p">):</span>
    <span class="c1"># 96 trials across 11 subjects</span>
    <span class="n">all_num_trials</span> <span class="o">=</span> <span class="mi">96</span> <span class="o">*</span> <span class="mi">11</span>

    <span class="c1">#init list to input bic values</span>
    <span class="n">bic_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">all_mods</span> <span class="o">=</span> <span class="n">list_of_dfs</span>
    <span class="n">all_num_params</span> <span class="o">=</span> <span class="n">list_of_num_params</span>

    <span class="c1"># get integrated BIC for each model</span>
    <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">num_params</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_mods</span><span class="p">,</span> <span class="n">all_num_params</span><span class="p">):</span>
        <span class="n">bic_temp</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">all_num_trials</span><span class="p">,</span> <span class="n">nll</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">mod</span><span class="p">[</span><span class="s1">&#39;NLL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">num_params</span><span class="o">=</span><span class="n">num_params</span><span class="p">)</span>
        <span class="n">bic_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bic_temp</span><span class="p">)</span>

    <span class="c1">#plot these values:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">all_mods</span><span class="p">)),</span> <span class="n">bic_list</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;BIC Score&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BIC Scores for Different Models&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">all_mods</span><span class="p">)),</span> <span class="n">df_names</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="n">list_of_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span><span class="p">,</span> <span class="n">df5</span><span class="p">]</span>
<span class="n">df_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;df1&#39;</span><span class="p">,</span> <span class="s1">&#39;df2&#39;</span><span class="p">,</span> <span class="s1">&#39;df3&#39;</span><span class="p">,</span> <span class="s1">&#39;df4&#39;</span><span class="p">,</span> <span class="s1">&#39;df5&#39;</span><span class="p">]</span>
<span class="n">list_of_num_params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">plot_bic</span><span class="p">(</span><span class="n">list_of_dfs</span><span class="p">,</span> <span class="n">list_of_num_params</span><span class="p">,</span> <span class="n">df_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_39_0.png" src="../_images/module-04-01_Prosocial-RL-Exercises-Solutions_39_0.png" />
</div>
</div>
<p>Which of these models fit the data best? Think about whether there be others that could do better!</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./solutions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Shawn A. Rhoads<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>